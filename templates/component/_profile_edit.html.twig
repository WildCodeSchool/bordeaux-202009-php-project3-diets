<div class="profile-edit">
    <div class="d-flex justify-content-center">
        <h2 class="page-title">Bonjour  {% if infos.company %} {{ infos.company.name }} {% endif %}
            {% if infos.freelancer %} {{ infos.freelancer.name }} {% endif %}
            {% if infos.dietetician%} {{ infos.dietetician.firstname }}  {{ infos.dietetician.lastname }} {% endif %} ! Heureux de vous revoir.</h2>
    </div>
    <div class="d-flex justify-content-center align-items-center flex-wrap mb-5">
        {% if is_granted('ROLE_CONTRIBUTOR') %}
        <div>Je propose :</div>
        <div class="profile-button-container d-flex flex-wrap justify-content-center">
            <div class="profile-button-container d-flex flex-wrap justify-content-center ml-2">
                <div class="form-modal-knowledge">
                    <button type="button" class="knowledge-button" data-toggle="modal" data-target="#modalKnowledge">
                        une connaissance
                    </button>
                    <div class="modal fade" id="modalKnowledge" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-body">
                                    {% include '/component/_newfiche_edit.html.twig' %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="profile-button-container d-flex flex-wrap justify-content-center ml-2">
                <div class="form-modal-service">
                    <button type="button" class="service-button" data-toggle="modal" data-target="#modalService">
                        un service
                    </button>
                    <div class="modal fade" id="modalService" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-body">
                                    {% include '/component/_newservice_edit.html.twig' %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="profile-button-container d-flex flex-wrap justify-content-center ml-2">
                <div class="form-modal-event">
                    <button type="button" class="event-button" data-toggle="modal" data-target="#modalEvent">
                        un évènement
                    </button>
                    <div class="modal fade" id="modalEvent" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-body">
                                    {% include '/component/_newevent_edit.html.twig' %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="container-fluid profile-main">
        <div class="row align-items-center justify-content-center">
            <div class="col-xl-6 col-12 d-flex justify-content-center">
                <div>
                    <div class="overflow-hidden">
                        <img class="profile-picture"
                             src=
                             {% if (infos.picture) == false %}
                                    {{ asset('build/images/profile-initial-picture.be6b2f1a.png') }}
                                {% else %}
                             /uploads/pictures/{{ infos.picture.name }}
                                {% endif %}
                             alt="photo_de_profil">
                    </div>
                </div>
            </div>
            <div class="col-xl-6 col-12 d-sm-flex  profile-text-center text-sm-left justify-content-xl-start justify-content-center justify-content-xs-start" >
                <div class="profile-informations">
                    <h3>{% if infos.company %} {{ infos.company.name }} {% endif %}
                    {% if infos.freelancer %} {{ infos.freelancer.name }} {% endif %}
                    {% if infos.dietetician %} {{ infos.dietetician.firstname }}  {{ infos.dietetician.lastname }} {% endif %}
                    </h3>
                    <p>
                        {% if infos.dietetician %}  {{ infos.dietetician.birthday|date("d/m/Y") }} {% endif %}
                    </p>
                    <p>
                        {% if infos.company %} {{ infos.company.siret }} {% endif %}
                        {% if infos.freelancer %} {{ infos.freelancer.siret }} {% endif %}
                        {% if infos.dietetician %} {{ infos.dietetician.adeli }} {% endif %}
                    </p>
                    <p>
                        {% if infos.company %} {{ infos.company.description }} {% endif %}
                        {% if infos.freelancer %} {{ infos.freelancer.description }} {% endif %}
                    </p>
                    <p> {{ infos.address }} </p>
                    <p> {{ infos.country }}</p>
                    <p> {{ infos.email }} </p>
                    <p> {{ infos.phone }} </p>
                    {% if infos.website %}
                        <p>Site internet : {{ infos.website }} </p>
                    {% endif %}
                    <a href="{{ path('profile_profil_edit', {'id': infos.id}) }}">Modifier mon profil </a>
                </div>
            </div>
            <a href="{{ path('payment_register_stripe', {'id': infos.id}) }}">Créer un compte stripe</a>
            <a id="checkout-subscription" href="#">S'abonner</a>
            <a href="{{ path('payment_create_portal_session') }}">Visualiser le portail</a>

        </div>
    </div>
</div>

{% block javascripts %}
<script type="text/javascript">
    // Create an instance of the Stripe object with your publishable API key

    var stripe = Stripe('{{ public_key }}');
    var checkoutButton = document.getElementById('checkout-subscription');

    checkoutButton.addEventListener('click', function() {
        // Create a new Checkout Session using the server-side endpoint you
        // created in step 3.
        fetch('/paiement/create-subscription/', {
            method: 'POST',
        })
            .then(function(response) {
                return response.json();
            })
            .then(function(session) {
                return stripe.redirectToCheckout({ sessionId: session.id });
            })
            .then(function(result) {
                // If `redirectToCheckout` fails due to a browser or network
                // error, you should display the localized error message to your
                // customer using `error.message`.
                if (result.error) {
                    alert(result.error.message);
                }
            })
            .catch(function(error) {
                console.error('Error:', error);
            });
    });
</script>
{% endblock %}
